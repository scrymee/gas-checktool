<script>
  // 日付の取得
  //const today = new Date();
  //document.getElementById('today').innerText = today.getMonth() + 1 +'/' + today.getDate() + ' ('+[ "日", "月", "火", "水", "木", "金", "土" ][today.getDay()]+')';


  const NAME_RELATION = {
    '散髪': {
      'id': 'haircut',
      'cautionDay': '30',
    },
    '遊ぶ': {
      'id': 'enjoy',
      'cautionDay': '5',
    },
    '買い物': {
      'id': 'other',
      'cautionDay': '99',
    },
    'サウナ': {
      'id': 'hotspring',
      'cautionDay': '10',
    }
  };

  /** *********************
   * 
   * 最初の読み込みによる実行
   * 
  ********************* */
  // NAME RELATIONのkey名に紐づくデータをカレンダーから取得して更新する
  Object.keys(NAME_RELATION).forEach((index) => {
    getFromCalender(index);
  })
  getRandomGoal()
  getRandomList100()

  /**
   * 
   * 画面更新処理
   * 
  */
  function updateCard(r) {
    // ----------------------------
    // 戻り値の取得
    //-----------------------------
    const res = JSON.parse(r);
    const NAME = res.name;
    console.log(res);
    const card = new SmallCard(res.name);
    card.setCount(res.count, '個');
    card.setText('最終日は' + res.lastDate + 'です');
    const option = res.isCaution ? 'text-danger' : 'text-success'
    card.setText('最後に行ってから' + res.passedDay + '日です', option);
    card.display()



  }
  /** *********************
   * 
   * textを持つカレンダーを取得する処理=> 完了するとscriptのupdate関数を実行する
   * 
  ********************* */
  function getFromCalender(text) {
    console.log(text);
    console.log(Common_Date.calcDay(Common_Date.getNow(), '-60'))
    google.script.run.
      withSuccessHandler(updateCard)
      .getLastEvent(text, Common_Date.calcDay(Common_Date.getNow(), '-60'), Common_Date.getNow());
  }

  /** *********************
   * 
   * textを持つカレンダーを取得する処理=> 完了するとscriptのupdate関数を実行する
   * 
  ********************* */
  function getAllFromCalender() {
    console.log(text);
    google.script.run.
      withSuccessHandler(updateCard)
      .getLastEvent(text);
  }


  /** *********************
   * 
   * textの値を登録する処理 => 完了するとscriptのupdate関数を実行する
   * 
  ********************* */
  function regist(text, startDate, endDate) {
    google.script.run
      .withSuccessHandler(update)
      .setCalenderData(text, startDate, endDate);
  }

  document.getElementById('haircut-btn').addEventListener('click', () => {
    const startDate = document.getElementById('haircut-starttime').value;
    const endDate = document.getElementById('haircut-endtime').value;
    regist('散髪', startDate, endDate)
  })
  /** *********************
   * 
   * textの値を登録する処理 => 完了するとscriptのupdate関数を実行する
   * 
  ********************* */
  function getRandomList100() {
    google.script.run
      .withSuccessHandler(updateList100)
      .getRandomList100();
  }

  function updateList100(r) {
    const res = JSON.parse(r);
    document.getElementById('list100').innerHTML = res.msg
  }
  function getRandomGoal() {
    google.script.run
      .withSuccessHandler(updateGoal)
      .getRandomGoal();
  }

  function updateGoal(r) {
    const res = JSON.parse(r);
    document.getElementById('goal').innerHTML = res.msg
  }
</script>